{% extends "dashboard_base.html" %}

{% block scripts %}
{{ super() }}
<script>
   function deleteNote(data, redirectUrl){
      console.log(data, redirectUrl);
      if(data){
         $.post(redirectUrl, {'delete': true}, function(result){
            window.location.replace("/dashboard");
         });
      }
   }  

</script>
{% endblock %}

{% block inner_content %}
{{ super() }}

<div class="panel-group" id="my-accordion">
{% for record in petdata %}
    <div class="panel panel-default">
        <div class="panel-heading">
            <a  href="#collapse-pet-{{ record.pet.pet_id }}" data-parent="#my-accordion" data-toggle="collapse" class="panel-title">{{ record.pet.desc }}</a>
        </div>
        <div class="panel-collapse collapse" id="collapse-pet-{{ record.pet.pet_id }}">
            <div class="panel-body">
               <form action = "/pet/manage/{{ record.pet.pet_id }}" method=post>
                  <fieldset>
                     {{ form.hidden_tag() }}
                     <div style = font-size:20px; font-weight:bold; margin-left:150px;>
                        <br>
                        {{ form.species.scientific_name.label }}: {{ record.species.scientific_name }} 
                        <a target="_blank" href="https://www.google.com/search?q={{ record.species.scientific_name|quote_plus }}&tbm=isch">
                           <span class="glyphicon glyphicon-picture" style="padding-left: 4px;" aria-hidden="true"></span>
                        </a>

                        {{ form.species.common_name.label }}: {{ record.species.common_name }} : {{ form.edit }} {{ form.note }} {{ form.delete }}
                        <br>
                        {{ form.pet.start.label }}: {{ record.pet.start }} : {{ form.pet.end.label }}: {{ record.pet.end }}
                        <br>
                        {{ form.species.endangered_status.label }}: {{ record.species.endangered_status }}
                        {{ form.species.iucn_category.label }}: {{ record.species.iucn_category }}
                        {{ form.species.iucn_id.label }}: {{ record.species.iucn_id }}
                        {{ form.species.cares.label }}: {{ record.species.cares }}
                        <br>

                        Notes:<br>
                        <div>
                        {% for note in record.notes %}
                           <div class="row well well-sm">
                              <div class="col-sm-10 col-md-10 col-lg-11 col-xl-11">
                                <p>{{ note.note }}</p>
                              </div>
                              <div class="col-sm-2 col-med-2 col-lg-1 col-xl-1">
                                 {% if note.public %}
                                    <span class="glyphicon glyphicon-star" style="padding-left: 4px;" aria-hidden="true"></span>
                                 {% else %}
                                    <span class="glyphicon glyphicon-star-empty" style="padding-left: 4px;" aria-hidden="true"></span>
                                 {% endif %}
                                 <a data-toggle="tooltip" title="Last Edited: {{ note.timestamp }}" href="{{ url_for('ui.manage_specific_pet_note_id', id=record.pet.pet_id, note_id=note.note_id) }}">
                                     <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                 </a>
                                 <a href="#" onclick="bootbox.confirm('Delete note?', function(r){ deleteNote(r, '{{ url_for('ui.manage_specific_pet_note_id', id=record.pet.pet_id, note_id=note.note_id) }}'); } );">
                                     <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                 </a>
                              </div>
                           </div>
                        {% endfor %}
                        </div>
                     </div>
                  </fieldset>
               </form>
            </div><!-- .accordion-inner -->
        </div><!-- .accordion-body -->
    </div><!-- .accordion-group -->
   <p>
{% endfor %}
</div>

{% endblock %}
