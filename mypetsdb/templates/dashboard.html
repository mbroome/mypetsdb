{% extends "dashboard_base.html" %}

{% block scripts %}
{{ super() }}
<script>
   function deleteItem(data, redirectUrl){
      console.log(data, redirectUrl);
      if(data){
         $.post(redirectUrl, {'delete': true}, function(result){
            window.location.replace("/dashboard");
         });
      }
   }  

</script>
{% endblock %}

{% block inner_content %}
{{ super() }}
{% if petdata|length <= 0 %}
No pets defined yet.  You can add a pet via the <b>Species Search</b> above.
{% else %}
<div class="panel-group" id="my-accordion">
{% for record in petdata %}
    <div class="panel panel-default">
        <div class="panel-heading"   href="#collapse-pet-{{ record.pet.pet_id }}" data-parent="#my-accordion" data-toggle="collapse">
            <a>{{ record.pet.desc }}</a> -  {{ record.species.scientific_name }}
        </div>
        <div class="panel-collapse collapse" id="collapse-pet-{{ record.pet.pet_id }}">
            <div class="panel-body">
               <form action = "/pet/manage/{{ record.pet.pet_id }}" method=post>
                  <fieldset>
                     {{ form.hidden_tag() }}
                     <!-- <div style = font-size:20px; font-weight:bold; margin-left:150px;> -->
                     <div>
                        {{ form.species.scientific_name.label }}: {{ record.species.scientific_name }} : 
                        <a target="_blank" title="Google image search" href="https://www.google.com/search?q={{ record.species.scientific_name|quote_plus }}&tbm=isch">
                           <span class="glyphicon glyphicon-picture" style="padding-left: 4px;" aria-hidden="true"></span>
                        </a>
                        <a data-toggle="tooltip" title="Last Edited: {{ record.species.timestamp }}" href="{{ url_for('ui.manage_specific_pet', id=record.pet.pet_id) }}">
                           <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                        </a>

                        <a title="Delete saved pet" href="#" onclick="bootbox.confirm('Delete Pet?', function(r){ deleteItem(r, '{{ url_for('ui.manage_specific_pet', id=record.pet.pet_id) }}'); } );">
                           <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                        </a>
                        <br>

                        {% if record.common|length > 0 %}
                        <label>Common Names:</label>
                        {% for c in record.common %}
                            {{ c.common_name }}{%- if not loop.last -%},{% endif %}
                        {% endfor %}
                        <br>
                        {% endif %}

                        {% if record.species.iucn_category|length > 0 %}
                        <label>IUCN Classification:</label>
                           {{ classifications[record.species.iucn_category] or record.species.iucn_category }} :
                           <a target="_blank" href="http://apiv3.iucnredlist.org/api/v3/taxonredirect/{{ record.species.iucn_id }}">IUCN Red List ({{ record.species.iucn_id }})</a>
                        <br>
                        {% endif %}

                        {% if record.species.cares_category |length > 0 %}
                        <label>Cares Classification:</label>
                           {{ classifications[record.species.cares_category] or record.species.cares_category }} :
                           <a target="_blank" href="{{ record.species.cares_link }}">CARES Website</a>
                        <br>
                        {% endif %}

                        {% if record.links |length > 0 %}
                        <label>Links:</label>
                           {% for link in record.links %}
                              <a target="_blank" href="{{ link.url }}">{{ link.source }}</a>{%- if not loop.last -%},{% endif %}
                           {% endfor %}
                        <br>
                        {% endif %}

                        <label>Notes</label>:
                        <a title="Add note" data-toggle="tooltip" href="{{ url_for('ui.manage_specific_pet_note', id=record.pet.pet_id) }}">
                           <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                        </a>
                        <br>

                        <div>
                        {% for note in record.notes %}
                           <div class="row well well-sm">
                              <div class="col-sm-10 col-md-10 col-lg-11 col-xl-11">
                                <p>{{ note.note }}</p>
                              </div>
                              <div class="col-sm-2 col-med-2 col-lg-1 col-xl-1">
                                 {% if note.public %}
                                    <span class="glyphicon glyphicon-star" style="padding-left: 4px;" aria-hidden="true"></span>
                                 {% else %}
                                    <span class="glyphicon glyphicon-star-empty" style="padding-left: 4px;" aria-hidden="true"></span>
                                 {% endif %}
                                 <a data-toggle="tooltip" title="Last Edited: {{ note.timestamp }}" href="{{ url_for('ui.manage_specific_pet_note_id', id=record.pet.pet_id, note_id=note.note_id) }}">
                                     <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                 </a>
                                 <a href="#" onclick="bootbox.confirm('Delete note?', function(r){ deleteItem(r, '{{ url_for('ui.manage_specific_pet_note_id', id=record.pet.pet_id, note_id=note.note_id) }}'); } );">
                                     <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                 </a>
                              </div>
                           </div>
                        {% endfor %}
                        </div>
                     </div>
                  </fieldset>
               </form>
            </div><!-- .accordion-inner -->
        </div><!-- .accordion-body -->
    </div><!-- .accordion-group -->
   <p>
{% endfor %}
</div>
{% endif %}

{% endblock %}
